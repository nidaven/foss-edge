FROM nidaven/nodered-influx:version1.0
COPY ./settings.js /data/
COPY ./package.json /data/
ARG ENVMQTTUSER
ARG ENVMQTTPASS
ARG MQTTHOSTNAME
ARG CLOUDMQTTIP
ARG CLOUDMQTTPORT
ARG CLOUDMQTTUSER
ARG CLOUDMQTTPASS
ARG DOCKER_INFLUXDB_INIT_ADMIN_TOKEN
ENV ENVMQTTUSER=${ENVMQTTUSER}
ENV ENVMQTTPASS=${ENVMQTTPASS}
ENV MQTTHOSTNAME=${MQTTHOSTNAME}
ENV CLOUDMQTTIP=${CLOUDMQTTIP}
ENV CLOUDMQTTPORT=${CLOUDMQTTPORT}
ENV CLOUDMQTTPASS=${CLOUDMQTTPASS}
ENV CLOUDMQTTUSER=${CLOUDMQTTUSER}
ENV DOCKER_INFLUXDB_INIT_ADMIN_TOKEN=${DOCKER_INFLUXDB_INIT_ADMIN_TOKEN}
RUN echo ${ENVMQTTPASS} ${ENVMQTTUSER} ${CLOUDMQTTIP} ${CLOUDMQTTPORT} ${CLOUDMQTTUSER} ${CLOUDMQTTPASS}
COPY ./flows.json /data/
COPY ./flows_cred.json /data/
RUN sed -i "s/DOCKER_INFLUXDB_INIT_ADMIN_TOKEN/${DOCKER_INFLUXDB_INIT_ADMIN_TOKEN}/" /data/flows_cred.json
RUN sed -i -e "s/CLOUDMQTTUSER/${CLOUDMQTTUSER}/" -e "s/CLOUDMQTTPASS/${CLOUDMQTTPASS}/" /data/flows_cred.json
RUN sed -i -e "s/ENVMQTTUSER/${ENVMQTTUSER}/" -e "s/ENVMQTTPASS/${ENVMQTTPASS}/" /data/flows_cred.json
RUN sed -i "s/MQTTHOSTNAME/${MQTTHOSTNAME}/" /data/flows.json
RUN sed -i -e "s/CLOUDMQTTIP/${CLOUDMQTTIP}/" -e "s/CLOUDMQTTPORT/${CLOUDMQTTPORT}/" /data/flows.json 

FROM nidaven/nodered-opcua
COPY ./nodered_configs/settings.js /data/
COPY ./nodered_configs/package.json /data/
ARG LOCALOPCUSER
ARG LOCALOPCPASS
ARG LOCALMQTTUSER
ARG LOCALMQTTPASS
# ARG OPCHOSTNAME
# ARG OPCPORT
ARG MQTTHOSTNAME
# ARG MQTTPORT
ENV LOCALOPCUSER=${LOCALOPCUSER}
ENV LOCALOPCPASS=${LOCALOPCPASS}
ENV LOCALMQTTUSER=${LOCALMQTTUSER}
ENV LOCALMQTTPASS=${LOCALMQTTPASS}
# ENV OPCHOSTNAME=${OPCHOSTNAME}
# ENV OPCPORT=${OPCPORT}
ENV MQTTHOSTNAME=${MQTTHOSTNAME}
RUN echo ${ENVOPCUSER} ${ENVOPCPASS} ${LOCALMQTTUSER} ${LOCALMQTTPASS} ${MQTTHOSTNAME}
# ENV MQTTPORT=${MQTTPORT}
COPY ./nodered_configs/flows.json /data/
COPY ./nodered_configs/flows_cred.json /data/
RUN sed -i -e "s/OPCUSER/${LOCALOPCUSER}/" -e "s/OPCPASSWORD/${LOCALOPCPASS}/" /data/flows_cred.json
RUN sed -i -e "s/MQTTUSER/${LOCALMQTTUSER}/" -e "s/MQTTPASSWORD/${LOCALMQTTPASS}/" /data/flows_cred.json
RUN sed -i "s/MQTTHOSTNAME/${MQTTHOSTNAME}/" /data/flows.json
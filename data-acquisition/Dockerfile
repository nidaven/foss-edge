FROM nidaven/nodered-opcua:version2.1
COPY ./settings.js /data/
COPY ./package.json /data/
ARG ENVOPCUSER
ARG ENVOPCPASS
ARG ENVMQTTUSER
ARG ENVMQTTPASS
# ARG OPCHOSTNAME
# ARG OPCPORT
ARG MQTTHOSTNAME
# ARG MQTTPORT
ENV ENVOPCUSER=${ENVOPCUSER}
ENV ENVOPCPASS=${ENVOPCPASS}
ENV ENVMQTTUSER=${ENVMQTTUSER}
ENV ENVMQTTPASS=${ENVMQTTPASS}
# ENV OPCHOSTNAME=${OPCHOSTNAME}
# ENV OPCPORT=${OPCPORT}
ENV MQTTHOSTNAME=${MQTTHOSTNAME}
RUN echo ${ENVOPCUSER} ${ENVOPCPASS} ${ENVMQTTUSER} ${ENVMQTTPASS} ${MQTTHOSTNAME}
# ENV MQTTPORT=${MQTTPORT}
COPY ./flows.json /data/
COPY ./flows_cred.json /data/
RUN sed -i -e "s/OPCUSER/${ENVOPCUSER}/" -e "s/OPCPASSWORD/${ENVOPCPASS}/" /data/flows_cred.json
RUN sed -i -e "s/MQTTUSER/${ENVMQTTUSER}/" -e "s/MQTTPASSWORD/${ENVMQTTPASS}/" /data/flows_cred.json
RUN sed -i "s/MQTTHOSTNAME/${MQTTHOSTNAME}/" /data/flows.json